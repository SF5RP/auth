# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É User Service

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Discord OAuth2 —Å –±—ç–∫–µ–Ω–¥–æ–º –Ω–∞ Go –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –Ω–∞ Next.js 15.

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

**Backend:**

- Go + Gin
- PostgreSQL
- JWT —Ç–æ–∫–µ–Ω—ã
- Discord OAuth2

**Frontend:**

- Next.js 15 (App Router)
- React 19 + TypeScript
- Redux Toolkit
- React Query (TanStack Query)
- Emotion (CSS-in-JS)

---

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Go** 1.21+ ([—É—Å—Ç–∞–Ω–æ–≤–∫–∞](https://golang.org/doc/install))
2. **Node.js** 18+ –∏ npm ([—É—Å—Ç–∞–Ω–æ–≤–∫–∞](https://nodejs.org/))
3. **PostgreSQL** 14+ ([—É—Å—Ç–∞–Ω–æ–≤–∫–∞](https://www.postgresql.org/download/))
4. **Discord Application** (—Å–º. —Ä–∞–∑–¥–µ–ª "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Discord")

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Discord Application

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [Discord Developer Portal](https://discord.com/developers/applications)
2. –ù–∞–∂–º–∏—Ç–µ "New Application" –∏ –¥–∞–π—Ç–µ –µ–π –∏–º—è
3. –í —Ä–∞–∑–¥–µ–ª–µ **OAuth2** —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **Client ID**
   - **Client Secret**
4. –î–æ–±–∞–≤—å—Ç–µ **Redirect URL**:
   ```
   http://localhost:8080/callback
   ```
5. –í —Ä–∞–∑–¥–µ–ª–µ **OAuth2 ‚Üí URL Generator** –≤—ã–±–µ—Ä–∏—Ç–µ scope `identify`

---

## üóÑÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ó–∞–ø—É—Å–∫ PostgreSQL —á–µ—Ä–µ–∑ Docker
docker-compose up -d db
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω–∞—è PostgreSQL

–°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤—Ä—É—á–Ω—É—é:

```sql
CREATE DATABASE authdb;
CREATE USER auth WITH PASSWORD 'authpassword';
GRANT ALL PRIVILEGES ON DATABASE authdb TO auth;
```

### –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
go run cmd/migrator/main.go up

# –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
go run cmd/migrator/main.go down
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### Backend

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `config.env`:

```env
# Discord OAuth2
DISCORD_CLIENT_ID=–≤–∞—à_client_id_–∏–∑_discord
DISCORD_CLIENT_SECRET=–≤–∞—à_client_secret_–∏–∑_discord
DISCORD_REDIRECT_URI=http://localhost:8080/callback

# Frontend URL
FRONTEND_URL=http://localhost:3000

# JWT
JWT_SECRET=–≤–∞—à_–æ—á–µ–Ω—å_–¥–ª–∏–Ω–Ω—ã–π_–∏_–±–µ–∑–æ–ø–∞—Å–Ω—ã–π_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á

# Server
SERVER_PORT=8080
ENVIRONMENT=development

# Database
DB_HOST=localhost
DB_PORT=5432
DB_USER=auth
DB_PASSWORD=authpassword
DB_NAME=authdb
DATABASE_URL=postgres://auth:authpassword@localhost:5432/authdb?sslmode=disable
```

### Frontend

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `frontend/.env.local`:

```env
NEXT_PUBLIC_API_URL=http://localhost:8080
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 1. –ó–∞–ø—É—Å–∫ Backend

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
go mod tidy

# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
go run cmd/migrator/main.go up

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
go run main.go
```

Backend –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:8080`

### 2. –ó–∞–ø—É—Å–∫ Frontend

```bash
# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–∞–ø–∫—É frontend
cd frontend

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev
```

Frontend –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:3000`

---

## üì± –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `http://localhost:3000`
2. –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Discord"
3. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Discord
4. –í—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Ñ–∏–ª—è

### –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —Ä–æ–ª—å `user`.

–†–æ–ª–∏:

- **user** - –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- **moderator** - –º–æ–¥–µ—Ä–∞—Ç–æ—Ä
- **admin** - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏)

–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–æ–ª–∏ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ `admin`, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL:

```sql
UPDATE users SET role = 'admin' WHERE id = 1;
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã —Å–º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–æ–ª—è–º–∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å.

---

## üê≥ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

### –ó–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ —Å—Ç–µ–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ –ë–î, Backend –∏ Frontend
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

### –¢–æ–ª—å–∫–æ Backend –∏ –ë–î

```bash
docker-compose up -d db backend
```

---

## üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

### Health Check

```bash
curl http://localhost:8080/health
```

### –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω—ã (–ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

–¢–æ–∫–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ cookies —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

### –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

```bash
curl -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  http://localhost:8080/me
```

### –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (admin)

```bash
curl -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  http://localhost:8080/admin/users
```

### –ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (admin)

```bash
curl -X POST \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"role":"admin"}' \
  http://localhost:8080/admin/users/2/role
```

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
auth/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migr–∞—Ç–æ—Ä/          # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database/          # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ë–î
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/          # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/        # Middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/            # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ migrations/            # SQL –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ main.go               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/              # Next.js —Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ features/         # Feature-–º–æ–¥—É–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ shared/           # –û–±—â–∏–π –∫–æ–¥
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml        # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ config.env               # Backend –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
‚îî‚îÄ‚îÄ DEPLOYMENT.md            # –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
```

---

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### Backend

```bash
# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
go run main.go

# –ó–∞–ø—É—Å–∫ —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π (–Ω—É–∂–µ–Ω air)
air

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
go test ./...
```

### Frontend

```bash
cd frontend

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev

# –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
npm run build

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –≤–µ—Ä—Å–∏–∏
npm start

# –õ–∏–Ω—Ç–∏–Ω–≥
npm run lint
```

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Backend –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ë–î

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `config.env`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

### Discord OAuth –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Client ID –∏ Client Secret –≤ `config.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Redirect URI –¥–æ–±–∞–≤–ª–µ–Ω –≤ Discord Application
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Redirect URI —Å–æ–≤–ø–∞–¥–∞–µ—Ç –≤ Discord –∏ `config.env`

### Frontend –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Backend

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Backend –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8080
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `NEXT_PUBLIC_API_URL` –≤ `.env.local`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Backend

### –û—à–∏–±–∫–∞ "Invalid refresh token"

–¢–æ–∫–µ–Ω—ã –º–æ–≥—É—Ç –∏—Å—Ç–µ—á—å –∏–ª–∏ –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã –∏–∑ –ë–î. –ü—Ä–æ—Å—Ç–æ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –∑–∞–Ω–æ–≤–æ.

---

## üìà –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- [ ] –î–æ–±–∞–≤–∏—Ç—å rate limiting
- [ ] –î–æ–±–∞–≤–∏—Ç—å email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus, Grafana)
- [ ] –î–æ–±–∞–≤–∏—Ç—å unit –∏ e2e —Ç–µ—Å—Ç—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD pipeline
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥—Ä—É–≥–∏—Ö OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

---

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.
